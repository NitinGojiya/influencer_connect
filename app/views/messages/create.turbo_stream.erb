<%= turbo_stream.append "messages" do %>
  <%= render partial: "messages/message", locals: { message: @message } %>
<% end %>

<%= turbo_stream.replace dom_id(@message) do %>
  <%= render "messages/form", conversation: @conversation, message: Message.new %>
<% end %>

<%= turbo_stream.replace "chat_list" do %>
  <%= render partial: "conversations/list", locals: {
        conversations: Conversation
          .includes(:messages, :sender, :receiver)
          .where("sender_id = :uid OR receiver_id = :uid", uid: Current.session.user.id)
          .order_by_last_message,
        user: Current.session.user } %>
<% end %>
