<!-- app/views/conversations/index.html.erb -->
<div class="flex flex-col md:flex-row max-h-[700px] bg-gray-100 w-full px-4">

  <!-- Left Sidebar (Conversations List) -->
  <div class="w-full md:w-1/3 border-r border-gray-300 bg-white overflow-y-auto">
    <div class="p-4 border-b font-bold text-lg">Chats</div>

    <div id="conversations" data-controller="chat">
      <%= turbo_frame_tag "chat_list" do %>
        <% @conversations.each do |conversation| %>
          <% other_user = (conversation.sender == @user ? conversation.receiver : conversation.sender) %>

          <%= link_to conversation_path(conversation),
                      data: { turbo_frame: "chat_window" },
                      class: "flex items-center p-4 border-b hover:bg-gray-100 cursor-pointer" do %>
            <div class="flex-shrink-0 w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center">
              <i class="fa-solid fa-user"></i>
            </div>
            <div class="ml-3">
              <p class="text-sm font-medium truncate"><%= other_user.email_address %></p>
              <p class="text-xs text-gray-500 truncate w-40 md:w-40">
                <%= conversation.messages.last&.content || "No messages yet" %>
              </p>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Right Side (Chat Window) -->
  <div class="flex-1 flex flex-col h-full">
    <%= turbo_frame_tag "chat_window" do %>
      <div class="flex items-center justify-center h-full text-gray-400 p-4">
        Select a chat to start messaging
      </div>
    <% end %>
  </div>

</div>
