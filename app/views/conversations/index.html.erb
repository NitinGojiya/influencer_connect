<!-- app/views/conversations/index.html.erb -->
<% content_for :title, "Chats | Influencer Connect" %>
<div class="flex flex-col md:flex-row max-h-[700px] bg-gray-100 w-full px-4">

  <!-- Left Sidebar (Conversations List) -->
  <div class="w-full md:w-1/3 border-r border-gray-300  overflow-y-auto">
    <div class="p-4 ">
        <div class="flex items-center space-x-6">
          <% if @profile&.profile_pic&.attached? %>
            <%= image_tag @profile.profile_pic.variant(resize_to_fill: [150, 150]).processed,
                class: "shadow-md w-20 h-20 rounded-full object-cover" %>
          <% else %>
          <% initial = if @user.profile&.full_name.present?
                @user.profile.full_name[0]
              elsif @user.email_address.present?
                @user.email_address[0]
              else
                "N"
              end %>

          <img class="w-20 h-20 rounded-full object-cover"
              src="https://placehold.co/100x100/A020F0/FFFFFF?text=<%= initial %>"
              alt="User profile photo">

          <% end %>

          <div>
            <h2 class="text-2xl font-semibold text-gray-900">
              <%= @user.profile&.full_name || @user.email_address || "No Name Available" %>
            </h2>
            <p class="text-gray-500 text-base">
              <%= @user.email_address || "No Email Available" %>
            </p>
          </div>
        </div>
        <div class="border-b font-bold text-lg">
          Chats
        </div>

    </div>

    <div id="conversations" data-controller="chat">
      <%= turbo_stream_from @user %>

    <% @conversations.order_by_last_message.each do |conversation| %>
      <%= render "conversations/list", conversation: conversation, user: @user %>
    <% end %>
    </div>
  </div>

  <!-- Right Side (Chat Window) -->
 <div class="flex-1 flex flex-col h-full">
  <%= turbo_frame_tag "chat_window" do %>
    <% if @conversation %>
    <%= render template: "conversations/show" %>

    <% else %>
      <div class="flex items-center justify-center h-full text-gray-400 p-4">
        Select a chat to start messaging
      </div>
    <% end %>
  <% end %>
</div>


</div>
