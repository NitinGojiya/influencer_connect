<!-- app/views/conversations/show.html.erb -->
<div class="flex flex-col h-screen w-full p-8 text-black rounded-lg shadow-lg">

  <%# Stream messages for this conversation and user %>
  <%= turbo_stream_from "messages_#{@conversation.id}_#{@user.id}" %>

  <!-- Chat Header -->
  <div class="p-4 border-b border-gray-700 bg-gray-100">
    <% other_user = (@conversation.sender == @user ? @conversation.receiver : @conversation.sender) %>
    <h2 class="text-lg font-semibold flex items-center space-x-2 text-black">
      <i class="fa-solid fa-user"></i>
      <span><%= other_user.email_address %></span>
    </h2>
  </div>

  <!-- Messages Area -->
  <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-2 bg-white">
    <%= render partial: 'messages/message', collection: @messages, as: :message %>
  </div>

  <!-- Message Input -->
  <div id="<%= dom_id(Message.new) %>" class="bg-gray-800">
    <%= form_with model: [@conversation, @message],
                  data: { turbo_stream: true },
                  html: { multipart: true },
                  class: "p-4 border-t border-gray-700 flex space-x-2" do |f| %>

      <!-- Text field -->
      <%= f.text_field :content,
          placeholder: "Type a message...",
          class: "flex-1 rounded-lg bg-gray-700 text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" %>

      <!-- File upload (hidden) -->
      <%= f.file_field :image, class: "hidden", id: "message_image_input" %>

      <!-- File upload button -->
      <label for="message_image_input"
             class="cursor-pointer bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600 text-white">
        ðŸ“Ž
      </label>

      <!-- Send button -->
      <%= f.submit "Send", class: "bg-blue-500 px-4 py-2 rounded-lg hover:bg-blue-600 text-white" %>
    <% end %>
  </div>

</div>
