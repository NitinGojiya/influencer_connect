<div class="p-6 rounded-2xl shadow-md border border-gray-200
            flex flex-col sm:flex-row items-center justify-around">

  <!-- Left side: title + donut -->
  <div class="mb-6 sm:mb-0 sm:mr-6 flex flex-col items-center">
    <h2 class="text-lg font-bold text-gray-200 mb-4">Traffic of Campaigns by Location</h2>

    <!-- Donut Chart with Stimulus -->
    <div data-controller="city-graph"
         data-city-graph-labels-value="<%= @traffic_by_city.map(&:location).to_json %>"
         data-city-graph-data-value="<%= @traffic_by_city.map(&:traffic).to_json %>"
         data-city-graph-colors-value="<%= @traffic_by_city.each_with_index.map { |_, idx| "hsl(#{idx * 360 / @traffic_by_city.size}, 70%, 50%)" }.to_json %>">

      <canvas id="donutChart" class="w-40 h-40"></canvas>
    </div>
  </div>

  <!-- Legend -->
  <div class="space-y-2 w-full sm:w-auto">
    <% total_cities = @traffic_by_city.size %>
    <% @traffic_by_city.each_with_index do |row, idx| %>
      <% hue = (idx * 360 / total_cities) %>
      <div class="flex items-center justify-between space-x-4">
        <div class="flex items-center">
          <span class="w-3 h-3 rounded-full mr-2" style="background-color: hsl(<%= hue %>, 70%, 50%)"></span>
          <span class="text-sm text-gray-100"><%= row.location %></span>
        </div>
        <span class="text-sm font-semibold text-gray-200">
          <%= number_with_precision(row.traffic, precision: 0) %>
        </span>
      </div>
    <% end %>
  </div>
</div>
